<template>
    <v-container fluid class="custom-container">
        <!-- Ï†ÑÏ≤¥ container -->
        <v-spacer :style="{height: '50px'}"></v-spacer>
        <v-img
            alt="MainPageBanner"
            src="https://sejeong-file.s3.ap-northeast-2.amazonaws.com/devjeans-sid/main_page_banner.png"
        ></v-img>

        <v-spacer :style="{height: '50px'}"></v-spacer>

        <!-- ÏßÄÍ∏à Î™®ÏßëÏ§ëÏù∏ Ïù∏Í∏∞Í≥µÍ≥† container -->
        <v-container style="background-color: #F3F3F3; border-radius:15px; max-width: 1200px;">
            <v-spacer :style="{height: '20px'}"></v-spacer>

            <v-row>
                <v-col>
                    <h2 style="text-align:center">üî• ÏßÄÍ∏à Î™®ÏßëÏ§ëÏù∏ Ïù∏Í∏∞Í≥µÍ≥† üî•</h2>
                </v-col>
            </v-row>

            <v-row justify="center" align="center">
                <h5 style="text-align: center; color: #787575;">
                    Í≥†ÎØºÏùÄ ÏÑ±Ïû•Îßå Îä¶Ï∂ú Îøê! Si-DerÏôÄ Ìï®Íªò ÏÑ±Ïû• SurfingÏóê ÎèôÏ∞∏ÌïòÏÑ∏ÏöîüèÑ
                </h5>
            </v-row>

            <v-row justify="center">
                <v-card
                    style="background-color: #F3F3F3; border-radius: 15px; padding: 20px; max-width: 1200px; width: 100%;"
                    rounded="0"
                    flat
                >
                    <v-window v-model="onboardingProject" style="max-width: 1200px; width: 100%;">
                        <v-window-item v-for="n in windowCount" :key="`window-${n}`" :value="n">
                            <v-row class="d-flex justify-center">
                                <v-col
                                    v-for="(project, index) in paginatedProjects(n)"
                                    :key="index"
                                    cols="12"
                                    md="3"
                                    class="d-flex justify-center"
                                >
                                    <v-card 
                                        class="mx-auto" 
                                        style="width: 100%; max-width: 250px;"
                                        @click="() => moveToProject(project.id)"
                                    >
                                        <v-img
                                            class="custom-img"
                                            height="250"
                                            :src="project.launchedProjectImage"
                                            alt="LaunchedProject Ïç∏ÎÑ§Ïùº"
                                            cover
                                        />
                                        <v-card-title class="d-flex justify-space-between align-center">
                                            <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                                {{ project.projectName }}
                                            </span>
                                            <v-chip color="primary" text-color="white">
                                                üçæ {{ project.scraps }}
                                            </v-chip>
                                        </v-card-title>
                                        <v-card-subtitle class="pt-3 mr-5 custom-contents">
                                            <div>{{ project.launchedProjectContents }}</div>
                                        </v-card-subtitle>
                                        <v-card-subtitle class="pt-2 mr-5 custom-contents">
                                            <div class="mb-4">{{ project.techStacks }}</div>
                                        </v-card-subtitle>
                                    </v-card>
                                </v-col>
                            </v-row>
                        </v-window-item>
                    </v-window>

                    <v-card-actions class="justify-space-between">
                        <v-btn icon="mdi-chevron-left" variant="plain" @click="prevProject"></v-btn>
                        <v-item-group v-model="onboardingProject" class="text-center" mandatory>
                            <v-item
                                v-for="n in windowCount"
                                :key="`btn-${n}`"
                                v-slot="{ isSelected, toggle }"
                                :value="n"
                            >
                                <v-btn
                                    :color="isSelected ? 'primary' : 'secondary'"
                                    icon="mdi-circle-small"
                                    @click="toggle"
                                ></v-btn>
                            </v-item>
                        </v-item-group>
                        <v-btn icon="mdi-chevron-right" variant="plain" @click="nextProject"></v-btn>
                    </v-card-actions>
                </v-card>
            </v-row>

            <v-row justify="center" style="margin-top: -20px;">
                <v-btn
                    class="custom-button"
                    style="background-color: #E6E6E6;"
                    text :to="{path:'/project/list'}"
                >Î™®Ïßë Í≥µÍ≥† ÎçîÎ≥¥Í∏∞</v-btn>
            </v-row> 

            <v-spacer :style="{height: '30px'}"></v-spacer>

        </v-container>
        
        <v-spacer :style="{height: '50px'}"></v-spacer>

        <!-- Launched Project container -->
        <v-container style="background-color: #F3F3F3; border-radius: 15px; max-width: 1200px; padding: 20px;">
            <v-row>
                <v-col>
                    <h2 style="text-align: center">üöÄ Launched Project üöÄ</h2>
                </v-col>
            </v-row>

            <v-row justify="center" align="center">
                <h5 style="text-align: center; color: #787575;">
                    Si-DÏóê Ìï©Î•òÌïòÎ©¥ Ïù¥Îü∞ ÌîÑÎ°úÏ†ùÌä∏Î•º ÏßÑÌñâÌï† Ïàò ÏûàÏñ¥Ïöî!
                </h5>
            </v-row>

            <v-spacer :style="{ height: '30px' }"></v-spacer>

            <v-row justify="center">
                <v-card
                    style="background-color: #F3F3F3; border-radius: 15px; padding: 20px; max-width: 1200px; width: 100%;"
                    rounded="0"
                    flat
                >
                    <v-window v-model="onboardingLaunchedProject" style="max-width: 1200px; width: 100%;">
                        <v-window-item v-for="n in windowCount" :key="`window-${n}`" :value="n">
                            <v-row class="d-flex justify-center">
                                <v-col
                                    v-for="(project, index) in paginatedLaunchedProjects(n)"
                                    :key="index"
                                    cols="12"
                                    md="3"
                                    class="d-flex justify-center"
                                >
                                    <v-card 
                                        class="mx-auto" 
                                        style="width: 100%; max-width: 250px;"
                                        @click="() => moveToProject(project.id)"
                                    >
                                        <v-img
                                            class="custom-img"
                                            height="250"
                                            :src="project.launchedProjectImage"
                                            alt="LaunchedProject Ïç∏ÎÑ§Ïùº"
                                            cover
                                        />
                                        <v-card-title class="d-flex justify-space-between align-center">
                                            <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                                {{ project.projectName }}
                                            </span>
                                            <v-chip color="primary" text-color="white">
                                                üçæ {{ project.scraps }}
                                            </v-chip>
                                        </v-card-title>
                                        <v-card-subtitle class="pt-3 mr-5 custom-contents">
                                            <div>{{ project.launchedProjectContents }}</div>
                                        </v-card-subtitle>
                                        <v-card-subtitle class="pt-2 mr-5 custom-contents">
                                            <div class="mb-4">{{ project.techStacks }}</div>
                                        </v-card-subtitle>
                                    </v-card>
                                </v-col>
                            </v-row>
                        </v-window-item>
                    </v-window>

                    <v-card-actions class="justify-space-between">
                        <v-btn icon="mdi-chevron-left" variant="plain" @click="prevLaunchedProject"></v-btn>
                        <v-item-group v-model="onboardingLaunchedProject" class="text-center" mandatory>
                            <v-item
                                v-for="n in windowCount"
                                :key="`btn-${n}`"
                                v-slot="{ isSelected, toggle }"
                                :value="n"
                            >
                                <v-btn
                                    :color="isSelected ? 'primary' : 'secondary'"
                                    icon="mdi-circle-small"
                                    @click="toggle"
                                ></v-btn>
                            </v-item>
                        </v-item-group>
                        <v-btn icon="mdi-chevron-right" variant="plain" @click="nextLaunchedProject"></v-btn>
                    </v-card-actions>
                </v-card>
            </v-row>

            <v-row justify="center" style="margin-top: -20px;">
                <v-btn
                    class="custom-button"
                    style="background-color: #E6E6E6;"
                    text :to="{path:'/launched-project/list'}"
                >Launched Project ÎçîÎ≥¥Í∏∞</v-btn>
            </v-row> 

            <v-spacer :style="{height: '30px'}"></v-spacer>
        </v-container>

        <v-spacer :style="{height: '50px'}"></v-spacer>

        <!-- Si-DerÏôÄ Ìï®ÍªòÌï¥Î≥¥ÏÑ∏Ïöî container -->
        <v-container style="background-color: #DEF5EC; border-radius:15px; max-width: 1200px;">
            <v-spacer :style="{height: '20px'}"></v-spacer>

            <v-row>
                <v-col>
                    <h2 style="text-align:center; color: #094F08">üçÄ Si-DerÏôÄ Ìï®ÍªòÌï¥Î≥¥ÏÑ∏Ïöî!</h2>
                </v-col>
            </v-row>

            <v-row justify="center">
                <v-card
                    style="background-color: #F3F3F3; border-radius: 15px; padding: 20px; max-width: 1200px; width: 100%;"
                    rounded="0"
                    flat
                >
                    <v-window v-model="onboardingSiderCard" style="max-width: 1200px; width: 100%;">
                        <v-window-item v-for="n in windowCount" :key="`window-${n}`" :value="n">
                            <v-row class="d-flex justify-center">
                                <v-col
                                    v-for="(siderCard, index) in paginatedSiderCards(n)"
                                    :key="index"
                                    cols="12"
                                    md="3"
                                    class="d-flex justify-center"
                                >
                                    <v-card 
                                        class="mx-auto" 
                                        style="width: 100%; max-width: 250px;"
                                        @click="() => moveToSiderCard(siderCard.id)"
                                    >
                                        <v-img
                                            class="custom-img"
                                            height="250"
                                            :src="siderCard.imageUrl || defaultImageUrl"
                                            alt="SiderCard Ïç∏ÎÑ§Ïùº"
                                            cover
                                        />
                                        <v-card-title class="d-flex justify-space-between align-center">
                                            <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                                {{ siderCard.title }}
                                            </span>
                                        </v-card-title>
                                        <v-card-subtitle class="pt-3 mr-5 custom-contents">
                                            <div>{{ siderCard.contents }}</div>
                                        </v-card-subtitle>
                                    </v-card>
                                </v-col>
                            </v-row>
                        </v-window-item>
                    </v-window>

                    <v-card-actions class="justify-space-between">
                        <v-btn icon="mdi-chevron-left" variant="plain" @click="prevSiderCard"></v-btn>
                        <v-item-group v-model="onboardingSiderCard" class="text-center" mandatory>
                            <v-item
                                v-for="n in windowCount"
                                :key="`btn-${n}`"
                                v-slot="{ isSelected, toggle }"
                                :value="n"
                            >
                                <v-btn
                                    :color="isSelected ? 'primary' : 'secondary'"
                                    icon="mdi-circle-small"
                                    @click="toggle"
                                ></v-btn>
                            </v-item>
                        </v-item-group>
                        <v-btn icon="mdi-chevron-right" variant="plain" @click="nextSiderCard"></v-btn>
                    </v-card-actions>
                </v-card>
            </v-row>

            <v-row justify="center" style="margin-top: -20px;">
                <v-btn
                    class="custom-button"
                    style="background-color: #A4C89C; color: #094F08"
                    text :to="{path:'/sider-card/list'}"
                >Sider-Card ÎçîÎ≥¥Í∏∞</v-btn>
            </v-row> 

            <v-spacer :style="{height: '30px'}"></v-spacer>
        </v-container>

    </v-container>

    <v-dialog v-model="acceptDialog" width="500px">
        <v-card class="dialog-card" style="text-align: center">
            <v-card-title>
                ÏÇ¨Ïù¥ÎçîÏπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏Î•º ÌïòÎ©¥<br> ÌîÑÎ°úÏ†ùÌä∏ ÏßÄÏõêÌïòÎäîÎç∞ ÎèÑÏõÄÏù¥ ÎèºÏöî!
            </v-card-title>
            <v-card-text>
                ÏÇ¨Ïù¥ÎçîÏπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏Î•º Í∂åÏû•Ìï©ÎãàÎã§.
            </v-card-text>
        
                <v-card-actions>
                <v-spacer></v-spacer>
                <v-btn color="sid_btn1" text @click="acceptDialog = false">Îã§ÏùåÏóê Ìï†ÎûòÏöî</v-btn>
                <v-btn color="sid_btn2" text @click="accept">ÏßÄÍ∏à Ìï†Í≤åÏöî</v-btn>
                </v-card-actions>
        </v-card>
    </v-dialog>
    
</template>

<script>
import axios from 'axios';

export default {
  data() {
    return {
      acceptDialog: false,
      launched_projects: [],
      projects: [],
      siderCards: [],
      defaultImageUrl: "https://sejeong-file.s3.ap-northeast-2.amazonaws.com/devjeans-sid/default_profile_image.png", // ÏÇ¨Ïù¥ÎçîÏπ¥Îìú ÏÑ§Ï†ï ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑ ÏóÜÏùÑ Ïãú defaultÏÇ¨ÏßÑÏúºÎ°ú ÎåÄÏ≤¥
      onboardingProject: 1,
      onboardingLaunchedProject: 1,
      onboardingSiderCard: 1,
      windowCount: 2,
    };
  },
  created(){
    if(localStorage.getItem('state') && localStorage.getItem('state')=="first"){
        this.acceptDialog = true
        localStorage.setItem('state',null)
    }
    this.loadLaunchedProject();
    this.loadSiderCard();
    this.loadProject();
  },
  methods:{
    async loadLaunchedProject(){
        try {
            const response = await axios.get(`${process.env.VUE_APP_API_BASE_URL}/api/main/top-launched-project`);
            console.log(response.data.content);

            // Pageable Í∞ùÏ≤¥ÏóêÏÑú content ÌïÑÎìúÎßå Ï∂îÏ∂úÌïòÏó¨ launched_projectsÏóê Ìï†Îãπ
            this.launched_projects = response.data.content.map(project => {
                return {
                    ...project,
                    techStacks: project.techStacks.join(' ¬∑ ') // techStacks Î∞∞Ïó¥ÏùÑ Î¨∏ÏûêÏó¥Î°ú Î≥ÄÌôò
                };
            });
        } catch (error) {
            console.error("Î©îÏù∏ÌéòÏù¥ÏßÄ LaunchedProject Î¶¨Ïä§Ìä∏ data load ÏóêÎü¨:", error);
        }
    },
    async loadSiderCard(){
        try {
            const response = await axios.get(`${process.env.VUE_APP_API_BASE_URL}/api/main/top-sider-card`);
            console.log(response.data.content);
            
            this.siderCards = response.data.content;
        } catch (error) {
            console.error("Î©îÏù∏ÌéòÏù¥ÏßÄ SiderCard Î¶¨Ïä§Ìä∏ data load ÏóêÎü¨:", error);
        }    
    },
    async loadProject(){
        try {
            const response = await axios.get(`${process.env.VUE_APP_API_BASE_URL}/api/main/top-project`);
            console.log(response.data.content);
            
            this.projects = response.data.content;
        } catch (error) {
            console.error("Î©îÏù∏ÌéòÏù¥ÏßÄ Project Î¶¨Ïä§Ìä∏ data load ÏóêÎü¨:", error);
        }  
    },
    accept(){
        this.acceptDialog = false;
        this.$router.push(`/sider-card`);
    },
    prevProject() {
      if (this.onboardingProject > 1) this.onboardingProject--;
    },
    nextProject() {
      if (this.onboardingProject < this.windowCount) this.onboardingProject++;
    },
    paginatedProjects(n) {
      const itemsPerPage = Math.ceil(this.projects.length / this.windowCount);
      const start = (n - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      return this.projects.slice(start, end);
    },
    prevLaunchedProject() {
      if (this.onboardingLaunchedProject > 1) this.onboardingLaunchedProject--;
    },
    nextLaunchedProject() {
      if (this.onboardingLaunchedProject < this.windowCount) this.onboardingLaunchedProject++;
    },
    paginatedLaunchedProjects(n) {
      const itemsPerPage = Math.ceil(this.launched_projects.length / this.windowCount);
      const start = (n - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      return this.launched_projects.slice(start, end);
    },
    prevSiderCard() {
      if (this.onboardingSiderCard > 1) this.onboardingSiderCard--;
    },
    nextSiderCard() {
      if (this.onboardingSiderCard < this.windowCount) this.onboardingSiderCard++;
    },
    paginatedSiderCards(n) {
      const itemsPerPage = Math.ceil(this.siderCards.length / this.windowCount);
      const start = (n - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      return this.siderCards.slice(start, end);
    },
    moveToProject(id) {
      this.$router.push(`/project/${id}`);
    },
    moveToSiderCard(id) {
      this.$router.push(`/sider-card/${id}`);
    },
  },
};
</script>

<style scoped>
.custom-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 16px;
}
.custom-button {
  font-weight: bold !important; /* Í∏ÄÏî®Î•º boldÎ°ú */
  font-size: 14px !important; /* Í∏ÄÏî® ÌÅ¨Í∏∞ */
  color: black !important;
  text-transform: none !important; /* ÎåÄÎ¨∏Ïûê Î≥ÄÌôò Î∞©ÏßÄ */
}
.custom-contents {
  padding-right: 2px !important; /* Ïπ¥ÎìúÏùò Ïò§Î•∏Ï™Ω ÎÅùÏóêÏÑú 2px Îñ®Ïñ¥ÏßÄÎèÑÎ°ù */
  white-space: nowrap !important; /* ÌÖçÏä§Ìä∏Í∞Ä Ìïú Ï§ÑÎ°ú ÌëúÏãúÎêòÎèÑÎ°ù */
  overflow: hidden !important; /* ÎÑòÏπòÎäî Î∂ÄÎ∂ÑÏù¥ Î≥¥Ïù¥ÏßÄ ÏïäÎèÑÎ°ù */
  text-overflow: ellipsis !important; /* ÎÑòÏπòÎäî Î∂ÄÎ∂ÑÏùÄ '...'ÏúºÎ°ú ÌëúÏãúÎêòÎèÑÎ°ù */
}
.custom-img {
  border-radius: 10px;
}
</style>
